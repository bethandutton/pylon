// Card — Figma Component — Generated by figma-sync
// Execute via Figma Console MCP with the target file open

(async () => {
  const collections = await figma.variables.getLocalVariableCollectionsAsync();
  const colorCollection = collections.find(c => c.name === "Pylon/Colors");
  const colorCollectionId = colorCollection ? colorCollection.id : null;
  const radiiCollection = collections.find(c => c.name === "Pylon/Radii");

  // Helper: find a variable by name and collection
  async function findColorVar(name) {
    if (!colorCollectionId) return null;
    const vars = await figma.variables.getLocalVariablesAsync("COLOR");
    return vars.find(v => v.name === name && v.variableCollectionId === colorCollectionId) || null;
  }

  async function findFloatVar(name, collectionId) {
    if (!collectionId) return null;
    const vars = await figma.variables.getLocalVariablesAsync("FLOAT");
    return vars.find(v => v.name === name && v.variableCollectionId === collectionId) || null;
  }

  // Load font before creating text
  await figma.loadFontAsync({ family: "Inter", style: "Regular" });
  await figma.loadFontAsync({ family: "Inter", style: "Medium" });
  await figma.loadFontAsync({ family: "Inter", style: "Semi Bold" });
  await figma.loadFontAsync({ family: "Inter", style: "Bold" });

  const components = [];

  // Type=Shadow, State=Default
  {
    const node = figma.createComponent();
    node.name = "Type=Shadow, State=Default";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    components.push(node);
  }

  // Type=Shadow, State=Focused
  {
    const node = figma.createComponent();
    node.name = "Type=Shadow, State=Focused";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    // Focus ring effect
    node.effects = [{
      type: "DROP_SHADOW",
      color: { r: 0.42, g: 0.545, b: 0.643, a: 1 },
      offset: { x: 0, y: 0 },
      radius: 0,
      spread: 4,
      visible: true,
      blendMode: "NORMAL"
    }];
    components.push(node);
  }

  // Type=Shadow, State=Hover
  {
    const node = figma.createComponent();
    node.name = "Type=Shadow, State=Hover";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    components.push(node);
  }

  // Type=Elevated, State=Default
  {
    const node = figma.createComponent();
    node.name = "Type=Elevated, State=Default";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    components.push(node);
  }

  // Type=Elevated, State=Focused
  {
    const node = figma.createComponent();
    node.name = "Type=Elevated, State=Focused";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    // Focus ring effect
    node.effects = [{
      type: "DROP_SHADOW",
      color: { r: 0.42, g: 0.545, b: 0.643, a: 1 },
      offset: { x: 0, y: 0 },
      radius: 0,
      spread: 4,
      visible: true,
      blendMode: "NORMAL"
    }];
    components.push(node);
  }

  // Type=Elevated, State=Hover
  {
    const node = figma.createComponent();
    node.name = "Type=Elevated, State=Hover";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    components.push(node);
  }

  // Type=Interactive, State=Default
  {
    const node = figma.createComponent();
    node.name = "Type=Interactive, State=Default";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const strokeVar = await findColorVar("color-subtle");
    if (strokeVar) {
      const strokePaint = figma.variables.setBoundVariableForPaint({ type: "SOLID", color: {r:0,g:0,b:0} }, "color", strokeVar);
      node.strokes = [strokePaint];
      node.strokeWeight = 1;
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    components.push(node);
  }

  // Type=Interactive, State=Focused
  {
    const node = figma.createComponent();
    node.name = "Type=Interactive, State=Focused";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const strokeVar = await findColorVar("color-subtle");
    if (strokeVar) {
      const strokePaint = figma.variables.setBoundVariableForPaint({ type: "SOLID", color: {r:0,g:0,b:0} }, "color", strokeVar);
      node.strokes = [strokePaint];
      node.strokeWeight = 1;
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    // Focus ring effect
    node.effects = [{
      type: "DROP_SHADOW",
      color: { r: 0.42, g: 0.545, b: 0.643, a: 1 },
      offset: { x: 0, y: 0 },
      radius: 0,
      spread: 4,
      visible: true,
      blendMode: "NORMAL"
    }];
    components.push(node);
  }

  // Type=Interactive, State=Hover
  {
    const node = figma.createComponent();
    node.name = "Type=Interactive, State=Hover";
    const radiusVar = await findFloatVar("radius/lg", radiiCollection?.id);
    if (radiusVar) {
      node.setBoundVariable("topLeftRadius", radiusVar);
      node.setBoundVariable("topRightRadius", radiusVar);
      node.setBoundVariable("bottomLeftRadius", radiusVar);
      node.setBoundVariable("bottomRightRadius", radiusVar);
    }
    const strokeVar = await findColorVar("color-subtle");
    if (strokeVar) {
      const strokePaint = figma.variables.setBoundVariableForPaint({ type: "SOLID", color: {r:0,g:0,b:0} }, "color", strokeVar);
      node.strokes = [strokePaint];
      node.strokeWeight = 1;
    }
    const text = figma.createText();
    text.fontName = { family: "Inter", style: "Regular" };
    text.characters = "Card";
    node.appendChild(text);
    components.push(node);
  }

  if (components.length > 1) {
    const componentSet = figma.combineAsVariants(components, figma.currentPage);
    componentSet.name = "Card";

    // Auto-layout the component set for organization
    componentSet.layoutMode = "HORIZONTAL";
    componentSet.layoutWrap = "WRAP";
    componentSet.itemSpacing = 24;
    componentSet.counterAxisSpacing = 24;
    componentSet.paddingTop = 40;
    componentSet.paddingBottom = 40;
    componentSet.paddingLeft = 40;
    componentSet.paddingRight = 40;
    componentSet.primaryAxisSizingMode = "AUTO";
    componentSet.counterAxisSizingMode = "AUTO";
  } else if (components.length === 1) {
    components[0].name = "Card";
  }

  figma.notify("✓ Card: 9 variants created");
  figma.closePlugin();
})();
