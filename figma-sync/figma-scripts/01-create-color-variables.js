// Pylon Color Variables â€” Generated by figma-sync
// Execute via Figma Console MCP (figma_execute)
// API fixes: collection object (not ID), setVariableCodeSyntax() method

const collections = await figma.variables.getLocalVariableCollectionsAsync();
let collection = collections.find(c => c.name === "Pylon/Colors");
if (!collection) {
  collection = figma.variables.createVariableCollection("Pylon/Colors");
}

// Set up Light and Dark modes
const modes = collection.modes;
let lightModeId = modes[0].modeId;
collection.renameMode(lightModeId, "Light");

let darkModeId;
if (modes.length > 1) {
  darkModeId = modes[1].modeId;
  collection.renameMode(darkModeId, "Dark");
} else {
  darkModeId = collection.addMode("Dark");
}

function hexToRgba(hex) {
  hex = hex.replace("#", "");
  return {
    r: parseInt(hex.slice(0, 2), 16) / 255,
    g: parseInt(hex.slice(2, 4), 16) / 255,
    b: parseInt(hex.slice(4, 6), 16) / 255
  };
}

async function upsertColor(name, lightHex, darkHex) {
  const existing = (await figma.variables.getLocalVariablesAsync("COLOR"))
    .find(v => v.name === name && v.variableCollectionId === collection.id);
  const variable = existing || figma.variables.createVariable(name, collection, "COLOR");

  variable.setValueForMode(lightModeId, hexToRgba(lightHex));
  variable.setValueForMode(darkModeId, hexToRgba(darkHex));
  variable.scopes = ["ALL_FILLS", "STROKE_COLOR"];
  variable.setVariableCodeSyntax("WEB", "--pylon-" + name.replace(/\//g, "-"));
}

await upsertColor("color-dark", "#1A1A18", "#F0F0EE");
await upsertColor("color-base", "#3D3D3A", "#D4D4D1");
await upsertColor("color-muted", "#6B6B66", "#9C9C97");
await upsertColor("color-subtle", "#B0B0AC", "#6B6B66");
await upsertColor("color-border", "#D4D4D1", "#3D3D3A");
await upsertColor("color-surface", "#F7F7F6", "#252523");
await upsertColor("color-white", "#FFFFFF", "#1A1A18");
await upsertColor("color-bg", "#FFFFFF", "#141412");
await upsertColor("color-brand", "#6B8BA4", "#8DAEC6");
await upsertColor("color-brand-dark", "#456A84", "#A5C3D6");
await upsertColor("color-brand-light", "#E8EFF4", "#1E2D38");
await upsertColor("color-success", "#2E7D32", "#66BB6A");
await upsertColor("color-success-light", "#E8F5E9", "#1B2E1C");
await upsertColor("color-warning", "#F57F17", "#FFC107");
await upsertColor("color-warning-light", "#FFF8E1", "#2E2510");
await upsertColor("color-error", "#C62828", "#EF5350");
await upsertColor("color-error-light", "#FDECEA", "#2E1616");

const count = (await figma.variables.getLocalVariablesAsync("COLOR"))
  .filter(v => v.variableCollectionId === collection.id).length;
console.log("\u2713 Pylon colors synced: " + count + " variables (Light + Dark modes)");
